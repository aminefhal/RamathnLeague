<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramathan League Draw</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .group {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .group h3 {
            font-size: 1.5rem;
            color: #34495e;
            margin-bottom: 15px;
        }

        .group p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #555;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        .hidden {
            display: none;
        }

        .standings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .standings-table th, .standings-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .standings-table th {
            background-color: #f2f2f2;
        }

        .update-input {
            width: 60px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div id="login" class="container">
        <h1>Login</h1>
        <div class="login-form">
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()">Login</button>
        </div>
    </div>

    <div id="user-interface" class="container hidden">
        <h1>Ramathan League Draw</h1>
        <div id="user-groups"></div>
        <div id="user-fixtures"></div>
        <div id="user-points" class="points-table"></div>
        <div id="user-top-scorers" class="points-table"></div>
        <!-- Player standings -->
        <div id="user-player-standings">
            <h2>Top Scorers</h2>
            <table class="standings-table" id="user-player-standings-table">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Goals</th>
                        <th>Update</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <div id="admin-interface" class="container hidden">
        <h1>Ramathan League Draw (Admin View)</h1>
        <div id="admin-groups"></div>
        <div id="admin-fixtures"></div>
        <div id="admin-points" class="points-table"></div>
        <div id="admin-top-scorers" class="points-table"></div>
        <div id="admin-player-goals" class="points-table"></div>
        <!-- Player standings -->
        <div id="admin-player-standings">
            <h2>Top Scorers</h2>
            <table class="standings-table" id="admin-player-standings-table">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Goals</th>
                        <th>Update</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const backendUrl = "https://ramathnleague-4.onrender.com"; // Replace with your Render backend URL

        let groups = [];
        let fixtures = [];
        let pointsTable = {};
        let playerGoals = {};

        // Fetch data from the backend
        async function fetchData() {
            try {
                const response = await fetch(`${backendUrl}/data`);
                const result = await response.json();
                console.log("Fetched data:", result); // Debugging
                groups = result.groups;
                fixtures = result.fixtures;
                pointsTable = result.pointsTable;
                playerGoals = result.playerGoals;

                // Render the data based on the role
                if (document.getElementById("admin-interface").classList.contains("hidden")) {
                    renderUserInterface(); // Render for user
                } else {
                    renderAdminInterface(); // Render for admin
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        // Render user interface
        function renderUserInterface() {
            console.log("Rendering user interface"); // Debugging
            const userGroupsContainer = document.getElementById("user-groups");
            const userFixturesContainer = document.getElementById("user-fixtures");
            userGroupsContainer.innerHTML = "";
            userFixturesContainer.innerHTML = "<h2>Fixtures</h2>";

            // Render groups
            groups.forEach((group, index) => {
                let groupDiv = document.createElement("div");
                groupDiv.className = "group";
                groupDiv.innerHTML = `<h3>Group ${String.fromCharCode(65 + index)}</h3><p>${group.join("<br>")}</p>`;
                userGroupsContainer.appendChild(groupDiv);
            });

            // Render fixtures
            fixtures.forEach((groupFixtures, groupIndex) => {
                let fixtureDiv = document.createElement("div");
                fixtureDiv.className = "fixture-group";
                fixtureDiv.innerHTML = `<h3>Group ${String.fromCharCode(65 + groupIndex)} Fixtures</h3>`;
                groupFixtures.forEach((fixture, fixtureIndex) => {
                    fixtureDiv.innerHTML += `<p>${fixture.match} - ${fixture.score1} : ${fixture.score2}</p>`;
                });
                userFixturesContainer.appendChild(fixtureDiv);
            });

            // Render points table
            renderPointsTable("user-points");

            // Render top scorers
            renderTopScorers("user-top-scorers");

            // Render player standings
            renderPlayerStandings("user-player-standings-table");
        }

        // Render admin interface
        function renderAdminInterface() {
            console.log("Rendering admin interface"); // Debugging
            const adminGroupsContainer = document.getElementById("admin-groups");
            const adminFixturesContainer = document.getElementById("admin-fixtures");
            adminGroupsContainer.innerHTML = "";
            adminFixturesContainer.innerHTML = "<h2>Fixtures</h2>";

            // Render groups
            groups.forEach((group, index) => {
                let groupDiv = document.createElement("div");
                groupDiv.className = "group";
                groupDiv.innerHTML = `<h3>Group ${String.fromCharCode(65 + index)}</h3><p>${group.join("<br>")}</p>`;
                adminGroupsContainer.appendChild(groupDiv);
            });

            // Render fixtures
            fixtures.forEach((groupFixtures, groupIndex) => {
                let fixtureDiv = document.createElement("div");
                fixtureDiv.className = "fixture-group";
                fixtureDiv.innerHTML = `<h3>Group ${String.fromCharCode(65 + groupIndex)} Fixtures</h3>`;
                groupFixtures.forEach((fixture, fixtureIndex) => {
                    fixtureDiv.innerHTML += `<p>${fixture.match}</p>
                                             <div class="admin-input">
                                                 <input type="number" id="score1-${groupIndex}-${fixtureIndex}" placeholder="Score 1">
                                                 <input type="number" id="score2-${groupIndex}-${fixtureIndex}" placeholder="Score 2">
                                                 <button onclick="updateScore(${groupIndex}, ${fixtureIndex})">Update Score</button>
                                             </div>`;
                });
                adminFixturesContainer.appendChild(fixtureDiv);
            });

            // Render points table
            renderPointsTable("admin-points");

            // Render top scorers
            renderTopScorers("admin-top-scorers");

            // Render player goals input
            renderPlayerGoalsInput();

            // Render player standings
            renderPlayerStandings("admin-player-standings-table");
        }

        // Render player standings with update input
        function renderPlayerStandings(elementId) {
            const tableBody = document.getElementById(elementId).getElementsByTagName("tbody")[0];
            tableBody.innerHTML = "";

            for (let player in playerGoals) {
                let row = tableBody.insertRow();
                let nameCell = row.insertCell(0);
                let goalsCell = row.insertCell(1);
                let updateCell = row.insertCell(2);

                nameCell.textContent = player;
                goalsCell.textContent = playerGoals[player];

                // Update button
                let updateButton = document.createElement("button");
                updateButton.textContent = "Update";
                updateButton.onclick = () => openUpdatePlayerModal(player);
                updateCell.appendChild(updateButton);
            }
        }

        // Open update player modal (admin only)
        function openUpdatePlayerModal(player) {
            const playerGoalsInput = prompt(`Enter new goal count for ${player}`, playerGoals[player]);
            if (playerGoalsInput != null) {
                playerGoals[player] = parseInt(playerGoalsInput, 10);
                renderPlayerStandings("admin-player-standings-table");
            }
        }

        // Render points table
        function renderPointsTable(elementId) {
            const pointsTableContainer = document.getElementById(elementId);
            pointsTableContainer.innerHTML = "<h2>Points Table</h2>";
            let table = document.createElement("table");
            table.classList.add("standings-table");
            let tableHeader = `<tr><th>Team</th><th>Points</th></tr>`;
            table.innerHTML = tableHeader;

            for (const team in pointsTable) {
                let row = table.insertRow();
                let teamCell = row.insertCell(0);
                let pointsCell = row.insertCell(1);
                teamCell.textContent = team;
                pointsCell.textContent = pointsTable[team];
            }
            pointsTableContainer.appendChild(table);
        }

        // Render top scorers
        function renderTopScorers(elementId) {
            const topScorersContainer = document.getElementById(elementId);
            topScorersContainer.innerHTML = "<h2>Top Scorers</h2>";
            let table = document.createElement("table");
            table.classList.add("standings-table");
            let tableHeader = `<tr><th>Player</th><th>Goals</th></tr>`;
            table.innerHTML = tableHeader;

            for (const player in playerGoals) {
                let row = table.insertRow();
                let playerCell = row.insertCell(0);
                let goalsCell = row.insertCell(1);
                playerCell.textContent = player;
                goalsCell.textContent = playerGoals[player];
            }

            topScorersContainer.appendChild(table);
        }

        // Handle login
        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            if (username === "admin" && password === "admin") {
                document.getElementById("login").classList.add("hidden");
                document.getElementById("admin-interface").classList.remove("hidden");
                fetchData(); // Fetch data for admin
            } else if (username === "user" && password === "user") {
                document.getElementById("login").classList.add("hidden");
                document.getElementById("user-interface").classList.remove("hidden");
                fetchData(); // Fetch data for user
            } else {
                alert("Invalid login credentials");
            }
        }
    </script>
</body>
</html>
