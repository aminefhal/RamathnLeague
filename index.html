<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramathan League Draw</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .group {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .group h3 {
            font-size: 1.5rem;
            color: #34495e;
            margin-bottom: 15px;
        }

        .group p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #555;
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #2980b9;
        }

        .hidden {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #3498db;
            color: white;
        }

        .admin-input input {
            width: 60px;
            padding: 5px;
            margin-right: 10px;
        }

        .admin-input {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div id="login" class="container">
        <h1>Login</h1>
        <div class="login-form">
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()">Login</button>
        </div>
    </div>

    <div id="user-interface" class="container hidden">
        <h1>Ramathan League Draw</h1>
        <div id="user-group-1-standings" class="points-table"></div>
        <div id="user-group-2-standings" class="points-table"></div>
        <div id="user-top-scorers" class="points-table"></div>
    </div>

    <div id="admin-interface" class="container hidden">
        <h1>Ramathan League Draw (Admin View)</h1>
        <div id="admin-group-1-standings" class="points-table"></div>
        <div id="admin-group-2-standings" class="points-table"></div>
        <div id="admin-top-scorers" class="points-table"></div>
        <div id="admin-player-goals" class="points-table"></div>

        <!-- Admin input for adding player goals -->
        <div class="admin-input">
            <h3>Add Player Goals</h3>
            <input type="text" id="player-name" placeholder="Player Name" />
            <input type="number" id="player-goals" placeholder="Goals" />
            <button onclick="addPlayerGoals()">Add Goals</button>
        </div>
    </div>

    <script>
        const backendUrl = "https://ramathnleague-4.onrender.com"; // Replace with your Render backend URL

        let groups = [];
        let fixtures = [];
        let pointsTable = {};
        let playerGoals = {};

        // Fetch data from the backend
        async function fetchData() {
            try {
                const response = await fetch(`${backendUrl}/data`);
                const result = await response.json();
                console.log("Fetched data:", result); // Debugging
                groups = result.groups;
                fixtures = result.fixtures;
                pointsTable = result.pointsTable;
                playerGoals = result.playerGoals;

                // Render the data based on the role
                if (document.getElementById("admin-interface").classList.contains("hidden")) {
                    renderUserInterface(); // Render for user
                } else {
                    renderAdminInterface(); // Render for admin
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        // Render user interface
        function renderUserInterface() {
            renderGroupStandings("user-group-1-standings", 0);
            renderGroupStandings("user-group-2-standings", 1);
            renderTopScorers("user-top-scorers");
        }

        // Render admin interface
        function renderAdminInterface() {
            renderGroupStandings("admin-group-1-standings", 0);
            renderGroupStandings("admin-group-2-standings", 1);
            renderTopScorers("admin-top-scorers");
            renderPlayerGoals("admin-player-goals");
        }

        // Render the points table for each group
        function renderGroupStandings(elementId, groupIndex) {
            const table = document.getElementById(elementId);
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Points</th>
                            <th>Played</th>
                            <th>Wins</th>
                            <th>Draws</th>
                            <th>Losses</th>
                            <th>Goals For</th>
                            <th>Goals Against</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const groupTeams = groups[groupIndex];

            groupTeams.forEach(team => {
                const teamStats = pointsTable[team] || { points: 0, played: 0, wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0 };
                tableHTML += `
                    <tr>
                        <td>${team}</td>
                        <td>${teamStats.points}</td>
                        <td>${teamStats.played}</td>
                        <td>${teamStats.wins}</td>
                        <td>${teamStats.draws}</td>
                        <td>${teamStats.losses}</td>
                        <td>${teamStats.goalsFor}</td>
                        <td>${teamStats.goalsAgainst}</td>
                    </tr>
                `;
            });

            tableHTML += "</tbody></table>";
            table.innerHTML = tableHTML;
        }

        // Render the top scorers table
        function renderTopScorers(elementId) {
            const table = document.getElementById(elementId);
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Goals</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Sort players by goals and then display them
            const sortedPlayers = Object.entries(playerGoals).sort((a, b) => b[1] - a[1]); // Sort by goals scored
            sortedPlayers.forEach(([player, goals]) => {
                tableHTML += `
                    <tr>
                        <td>${player}</td>
                        <td>${goals}</td>
                    </tr>
                `;
            });

            tableHTML += "</tbody></table>";
            table.innerHTML = tableHTML;
        }

        // Render player goals input section for the admin
        function renderPlayerGoals(elementId) {
            const table = document.getElementById(elementId);
            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Player</th>
                            <th>Goals</th>
                            <th>Update Goals</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Render each player with a field to update their goals
            Object.keys(playerGoals).forEach(player => {
                tableHTML += `
                    <tr>
                        <td>${player}</td>
                        <td>${playerGoals[player]}</td>
                        <td>
                            <input type="number" id="goal-input-${player}" placeholder="Goals" />
                            <button onclick="updatePlayerGoals('${player}')">Update</button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += "</tbody></table>";
            table.innerHTML = tableHTML;
        }

        // Update player goals manually from input
        function updatePlayerGoals(player) {
            const playerGoalsInput = document.getElementById(`goal-input-${player}`).value;

            if (playerGoalsInput && !isNaN(playerGoalsInput)) {
                // Update player goals in the local data object
                playerGoals[player] = parseInt(playerGoalsInput);

                // Re-render the top scorers table and player goals table
                renderTopScorers("admin-top-scorers");
                renderPlayerGoals("admin-player-goals");

                // Clear the input field
                document.getElementById(`goal-input-${player}`).value = '';
            } else {
                alert('Please enter a valid number of goals.');
            }
        }

        // Handle the login
        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            // Simple hardcoded login (for testing purposes)
            if (username === "admin" && password === "admin") {
                document.getElementById("login").classList.add("hidden");
                document.getElementById("admin-interface").classList.remove("hidden");
                fetchData();
            } else if (username === "user" && password === "user") {
                document.getElementById("login").classList.add("hidden");
                document.getElementById("user-interface").classList.remove("hidden");
                fetchData();
            } else {
                alert("Invalid login credentials.");
            }
        }

        // Add player goals manually
        function addPlayerGoals() {
            const playerName = document.getElementById("player-name").value;
            const playerGoalsInput = document.getElementById("player-goals").value;

            if (playerName && playerGoalsInput && !isNaN(playerGoalsInput)) {
                playerGoals[playerName] = parseInt(playerGoalsInput);

                // Re-render tables after updating
                renderTopScorers("admin-top-scorers");
                renderPlayerGoals("admin-player-goals");

                // Clear inputs
                document.getElementById("player-name").value = '';
                document.getElementById("player-goals").value = '';
            } else {
                alert('Please enter valid player name and goal count.');
            }
        }
    </script>
</body>
</html>
